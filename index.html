<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./css/scheduler.css">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/bootstrap-datetimepicker.min.css">
    <link rel="stylesheet" href="./css/jquery-ui.min.css">
    <link rel="stylesheet" href="./css/tippy.css">
    <link rel="stylesheet" href="./css/toastr.css">
  </head>
  <body>

    <div class="loaders">
      <img src="./assets/svg-loaders/ball-triangle.svg" width="100" alt="">
    </div>

    <div class="modal fade" id="editEventModal" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close pull-right" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h5 class="modal-title"><b id="title"></b></h5>
          </div>
          <div class="modal-body col-md-12">
            <form id="manageEvent" class="form-inline col-md-12">
              <div class="form-group col-md-5">
                <input required type="text" data-required-error="Selectionner une date de début" class="form-control datetimepicker" id="eventStart" placeholder="Date de début">
                <div class="help-block with-errors"></div>
              </div>
              <span style="line-height:38px" class="col-md-2 text-center">à</span>
              <div class="form-group col-md-5">
                <input required type="text" data-required-error="Selectionner une date de fin" class="form-control datetimepicker" id="eventEnd" placeholder="Date de fin">
                <div class="help-block with-errors"></div>
              </div>
              <div class="form-group col-md-12">
                <input required type="text" class="form-control" id="client" data-required-error="Selectionner un client" placeholder="Client" />
                <div class="help-block with-errors"></div>
              </div>
              <div id="groupType" class="form-group col-md-12">
                <select data-required-error="Selectionner un type de prestation" id="type" required class="form-control col-md-6">
                  <option>Hotline</option>
                  <option>Atelier</option>
                  <option>Contrat</option>
                  <option data-affaire="required">Installation</option>
                  <option>Developpement</option>
                </select>
                <div class="help-block with-errors"></div>
              </div>
              <div id="groupAffaire" class="form-group col-md-6">
                <input type="text" data-required-error="Indiquez un numéro d'affaire" class="form-control" id="affaire" placeholder="Numéro d'affaire">
                <div class="help-block with-errors"></div>
              </div>
              <div class="form-group col-md-12">
                <textarea class="form-control" id="comments" placeholder="Commentaires"></textarea>
              </div>
              <div id="groupTechs" class="form-group col-md-12">
                <label class="col-md-3">Techniciens : </label>
                <ul class="col-md-9">
                  <li style="background-image: url('./assets/avatar/mn.jpeg')"></li>
                  <li style="background-image: url('./assets/avatar/fq.jpeg')"></li>
                  <li style="background-image: url('./assets/avatar/gm.jpeg')"></li>
                  <li>
                    <span class="glyphicon glyphicon-plus"></span>
                  </li>
                </ul>
              </div>
              <div class="form-group col-md-12">
                <button type="cancel" class="btn btn-secondary pull-right" data-dismiss="modal">Annuler</button>
                <button type="submit" class="saveEvent btn btn-primary pull-right">Sauvegarder</button>
              </div>
            </form>
          </div>
          <div class="modal-footer">

          </div>
        </div>
      </div>
    </div>

    <div class="scheduler"></div>

  </body>
  <script src="./js/jquery-3.2.1.min.js"></script>
  <script src="./js/popper.min.js"></script>
  <script src="./js/bootstrap.min.js"></script>
  <script src="./js/moment.js"></script>
  <script src="./js/jquery-ui.min.js"></script>
  <script src="./js/bootstrap-datetimepicker.min.js"></script>
  <script src="./js/tippy.js"></script>
  <script src="./js/liveQuery.js"></script>
  <script src="./js/toastr.js"></script>
  <script src="./js/validator.min.js"></script>
  -<script src="./js/msal.js"></script>
  <script src="./js/o365_calendar.js"></script>
  <script src="./js/agent.js"></script>
  <script src="./js/event.js"></script>
  <script src="./js/scheduler.js"></script>
  <script>

    var modal = $('#editEventModal');

    $(function () {
        $('.datetimepicker').datetimepicker({
          stepping:15,
          format:"DD/MM/YYYY HH:mm",
          locale: 'fr',
          daysOfWeekDisabled: [0,6]
        });
    });

    $("#manageEvent").validator().on('submit', function (e) {
      if (!e.isDefaultPrevented()) {
        e.preventDefault();

        var values = {start : $('#eventStart').val(),
        end : $('#eventEnd').val(),
        client : $('#client').val(),
        type : $('#type').val(),
        comments : $('#comments').val()}

        if($('#title').html().indexOf("Ajout") >= 0)
          scheduler.addEvent(values);
        else
          scheduler.manageEvent(values);

        modal.modal('hide');
      }
    });

    var scheduler = $('.scheduler').scheduler();

    $('#type').change(function(e){
      if($('option:selected', this).attr("data-affaire") == "required"){
        $('#groupAffaire').show();
        $('#groupType').removeClass('col-md-12').addClass('col-md-6');
        $('#affaire').prop('required',true);
      } else {
        $('#groupAffaire').hide();
        $('#groupType').removeClass('col-md-6').addClass('col-md-12');
        $('#affaire').prop('required',false);
      }
    });

    /*$(".saveEvent").click(function(e){
      if(form.valid()){
        scheduler.addEvent();
      }
    });*/

  </script>
</html>
